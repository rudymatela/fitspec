#!/bin/bash
#
# bench: FitSpec benchmark runner, stores results in the results folder
#
# usage:
#   ./bin/bench <benchname> <args...>
#
# example:
#   make bench/sorting
#   ./bin/bench sorting -tint2 -m2000 -n1000


ROOT="`dirname $0`/.."

# $ join -a -b -c 10 20
# -a-b-c1020
join() {
	echo "$@" | tr -d ' '
}

main() {
	bname="$1"
	shift
	out="$ROOT/results/$bname`join "$@"`-$HOSTNAME"
	make bench/$bname
    echo "./bench/$bname $@" | tee $out
	/usr/bin/time --verbose $ROOT/bench/$bname "$@" 2>&1 | tee -a $out
}

main "$@"
