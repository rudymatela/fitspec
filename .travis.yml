sudo: false

language: haskell

ghc:
  - "8.0"
  - "7.10"
  - "7.8"

matrix:
  include:
    - ghc: '7.6'
      script: >
        make depend              GHCIMPORTDIRS=src:bench GHCFLAGS="-fno-warn-unrecognised-pragmas" &&
        make                     GHCIMPORTDIRS=src:bench GHCFLAGS="-fno-warn-unrecognised-pragmas" &&
        make test-without-hs-src GHCIMPORTDIRS=src:bench GHCFLAGS="-fno-warn-unrecognised-pragmas"
    - ghc: '7.4'
      script: >
        make depend              GHCIMPORTDIRS=src:bench GHCFLAGS="-fno-warn-unrecognised-pragmas" &&
        make                     GHCIMPORTDIRS=src:bench GHCFLAGS="-fno-warn-unrecognised-pragmas" &&
        make test-without-hs-src GHCIMPORTDIRS=src:bench GHCFLAGS="-fno-warn-unrecognised-pragmas"

install:
  - cabal install --only-dependencies

# TODO: as a definitive solution in place of overriding GHCIMPORTDIRS, we
# should not reference the leancheck folder directly and instead use a
# installed package.  This made sense when FitSpec/LeanCheck were in early
# stages of development, but does not anymore.
script:
  - >
    make depend              GHCIMPORTDIRS=src:bench &&
    make                     GHCIMPORTDIRS=src:bench &&
    make test-without-hs-src GHCIMPORTDIRS=src:bench
  - cabal configure --enable-tests --enable-benchmarks && cabal build && cabal test

notifications:
  email:
    on_failure: change
