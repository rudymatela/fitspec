#!/bin/bash
#
# Tests that tests also pass on the package generated by "cabal sdist".
pkgver=` cat fitspec.cabal | grep "^version:" | sed -e "s/version: *//"`
pkgname=`cat fitspec.cabal | grep "^name:"    | sed -e "s/name: *//"`
pkg=$pkgname-$pkgver
set -x
cabal sdist &&
cd dist &&
rm -rf $pkg/ &&
tar -xzf $pkg.tar.gz &&
cd $pkg/ &&
cabal configure --enable-tests --enable-benchmarks &&
cabal build &&
cabal test
