#!/bin/bash
#
# test-sdist: tests the package generated by "cabal sdist".
#
# Copyright (c) 2015-2017 Rudy Matela.
# Distributed under the 3-Clause BSD licence.
pkgver=` cat *.cabal | grep "^version:" | sed -e "s/version: *//"`
pkgname=`cat *.cabal | grep "^name:"    | sed -e "s/name: *//"`
pkg=$pkgname-$pkgver
set -x
cabal sdist &&
cd dist &&
rm -rf $pkg/ &&
tar -xzf $pkg.tar.gz &&
cd $pkg/ &&
cabal configure --enable-tests --enable-benchmarks &&
cabal build &&
cabal test
